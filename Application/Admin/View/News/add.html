<include file="Public/head" />
<style>
    .checkbox-inline input{
        margin-top: 2px;
    }
</style>
 <div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12  ">
            <div class="ibox float-e-margins">
                <div class="ibox-form[0][title]">
                    <h5>添加历史沿革</h5>
                </div>
                <form class="form-horizontal m-t content-form"  method="post">
                    <div class="ibox-content">
                        <div class="form-group">
                            <label style="float: left;color:red;">第1组</label>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">标题：</label>
                            <div class="col-sm-9">
                                <input name="form[0][title]" class="form-control input-title" type="text">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label">时间：</label>
                            <div class="col-sm-9">
                                <input name="form[0][time]" class="form-control input-title" type="text" placeholder="请输入年份，例如'1998年' ">
                            </div>
                        </div>

                        <div class="form-group" style="margin-bottom:13px">
                            <label class="col-sm-2 control-label">图片：</label>
                            <div class="col-sm-9">

                                <img id="course_image_1" src="" alt="" width='180' height="130">
                                <button onclick="clickInputFile(this)" class="btn" type="button">上传</button>
                                <input type="hidden" name="form[0][img]" value="">
                                <input type="file" accept="image/*" style="opacity:0;margin-top:-25px;width:0px;" name="upfile" id="course_image_1_file" onchange="uploadFile(this)"/>

                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label">内容：</label>
                            <div class="col-sm-9">
							    <!--<script id="editor_0" type="text/plain"  name="form[0][content]" style="height:600px;"></script>-->
                                <textarea name="form[0][content]" style="width: 100%;height: 60px;border: 1px solid #e5e6e7;" placeholder="请用简短的语言描述"></textarea>
                            </div>
                        </div>


                        <div class="form-group">
                            <label class="col-sm-2 control-label">发布到：</label>

                            <div class="col-sm-10">
                                <label class="checkbox-inline"><input type="checkbox" name="form[0][language][]" value="cn" >中文</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[0][language][]" value="en" >英语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[0][language][]" value="fr" >法语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[0][language][]" value="es" >西班牙语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[0][language][]" value="pt" >葡萄牙语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[0][language][]" value="ru" >俄语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[0][language][]" value="ar" >阿拉伯语</label>
                            </div>
                        </div>
                    </div>
                </form>

                <form class="form-horizontal m-t content-form"  method="post" style="display: none;">
                    <div class="ibox-content">
                        <div class="form-group">
                            <label style="float: left;color:red;">第2组</label>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">标题：</label>
                            <div class="col-sm-9">
                                <input name="form[1][title]" class="form-control input-title" type="text">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">时间：</label>
                            <div class="col-sm-9">
                                <input name="form[1][time]" class="form-control input-title" type="text" placeholder="请输入年份，例如'1998年' ">
                            </div>
                        </div>
                        <div class="form-group" style="margin-bottom:13px">
                            <label class="col-sm-2 control-label">图片：</label>
                            <div class="col-sm-9">

                                <img id="course_image_2" src="" alt="" width='180' height="130">
                                <button onclick="clickInputFile(this)" class="btn" type="button">上传</button>
                                <input type="hidden" name="form[1][img]" value="">
                                <input type="file" accept="image/*" style="opacity:0;margin-top:-25px;width:0px;" name="upfile" id="course_image_2_file" onchange="uploadFile(this)"/>

                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label">内容：</label>
                            <div class="col-sm-9">
                                <!--<script id="editor_1" type="text/plain"  name="form[1][content]" style="height:600px;"></script>-->
                                <textarea name="form[1][content]" style="width: 100%;height: 60px;border: 1px solid #e5e6e7;" placeholder="请用简短的语言描述"></textarea>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label">发布到：</label>

                            <div class="col-sm-10">
                                <label class="checkbox-inline"><input type="checkbox" name="form[1][language][]" value="cn" >中文</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[1][language][]" value="en" >英语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[1][language][]" value="fr" >法语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[1][language][]" value="es" >西班牙语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[1][language][]" value="pt" >葡萄牙语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[1][language][]" value="ru" >俄语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[1][language][]" value="ar" >阿拉伯语</label>
                            </div>
                        </div>
                    </div>
                </form>

                <form class="form-horizontal m-t content-form"  method="post" style="display: none;">
                    <div class="ibox-content">
                        <div class="form-group">
                            <label style="float: left;color:red;">第3组</label>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">标题：</label>
                            <div class="col-sm-9">
                                <input name="form[2][title]" class="form-control input-title" type="text">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">时间：</label>
                            <div class="col-sm-9">
                                <input name="form[2][time]" class="form-control input-title" type="text" placeholder="请输入年份，例如'1998年' ">
                            </div>
                        </div>

                        <div class="form-group" style="margin-bottom:13px;">
                            <label class="col-sm-2 control-label">图片：</label>
                            <div class="col-sm-9">

                                <img id="course_image_3" src="" alt="" width='180' height="130">
                                <button onclick="clickInputFile(this)" class="btn" type="button">上传</button>
                                <input type="hidden" name="form[2][img]" value="">
                                <input type="file" accept="image/*" style="opacity:0;margin-top:-25px;width:0px;" name="upfile" id="course_image_3_file" onchange="uploadFile(this)"/>

                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label">内容：</label>
                            <div class="col-sm-9">
                                <!--<script id="editor_2" type="text/plain"  name="form[2][content]" style="height:600px;"></script>-->
                                <textarea name="form[2][content]" style="width: 100%;height: 60px;border: 1px solid #e5e6e7;" placeholder="请用简短的语言描述"></textarea>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label">发布到：</label>

                            <div class="col-sm-10">
                                <label class="checkbox-inline"><input type="checkbox" name="form[2][language][]" value="cn" >中文</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[2][language][]" value="en" >英语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[2][language][]" value="fr" >法语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[2][language][]" value="es" >西班牙语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[2][language][]" value="pt" >葡萄牙语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[2][language][]" value="ru" >俄语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[2][language][]" value="ar" >阿拉伯语</label>
                            </div>
                        </div>
                    </div>
                </form>

                <form class="form-horizontal m-t content-form"  method="post" style="display: none;">
                    <div class="ibox-content">
                        <div class="form-group">
                            <label style="float: left;color:red;">第4组</label>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">标题：</label>
                            <div class="col-sm-9">
                                <input name="form[3][title]" class="form-control input-title" type="text">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">时间：</label>
                            <div class="col-sm-9">
                                <input name="form[3][time]" class="form-control input-title" type="text" placeholder="请输入年份，例如'1998年' ">
                            </div>
                        </div>
                        <div class="form-group" style="margin-bottom:13px">
                            <label class="col-sm-2 control-label">图片：</label>
                            <div class="col-sm-9">

                                <img id="course_image_4" src="" alt="" width='180' height="130">
                                <button onclick="clickInputFile(this)" class="btn" type="button">上传</button>
                                <input type="hidden" name="form[3][img]" value="">
                                <input type="file" accept="image/*" style="opacity:0;margin-top:-25px;width:0px;" name="upfile" id="course_image_4_file" onchange="uploadFile(this)"/>

                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label">内容：</label>
                            <div class="col-sm-9">
                                <!--<script id="editor_3" type="text/plain"  name="form[3][content]" style="height:600px;"></script>-->
                                <textarea name="form[3][content]" style="width: 100%;height: 60px;border: 1px solid #e5e6e7;" placeholder="请用简短的语言描述"></textarea>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label">发布到：</label>

                            <div class="col-sm-10">
                                <label class="checkbox-inline"><input type="checkbox" name="form[3][language][]" value="cn" >中文</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[3][language][]" value="en" >英语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[3][language][]" value="fr" >法语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[3][language][]" value="es" >西班牙语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[3][language][]" value="pt" >葡萄牙语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[3][language][]" value="ru" >俄语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[3][language][]" value="ar" >阿拉伯语</label>
                            </div>
                        </div>
                    </div>
                </form>

                <form class="form-horizontal m-t content-form"  method="post" style="display: none;">
                    <div class="ibox-content">
                        <div class="form-group">
                            <label style="float: left;color:red;">第5组</label>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">标题：</label>
                            <div class="col-sm-9">
                                <input name="form[4][title]" class="form-control input-title" type="text">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">时间：</label>
                            <div class="col-sm-9">
                                <input name="form[4][time]" class="form-control input-title" type="text" placeholder="请输入年份，例如'1998年' ">
                            </div>
                        </div>
                        <div class="form-group" style="margin-bottom:13px">
                            <label class="col-sm-2 control-label">图片：</label>
                            <div class="col-sm-9">

                                <img id="course_image_5" src="" alt="" width='180' height="130">
                                <button onclick="clickInputFile(this)" class="btn" type="button">上传</button>
                                <input type="hidden" name="form[4][img]" value="">
                                <input type="file" accept="image/*" style="opacity:0;margin-top:-25px;width:0px;" name="upfile" id="course_image_5_file" onchange="uploadFile(this)"/>

                            </div>
                        </div>


                        <div class="form-group">
                            <label class="col-sm-2 control-label">内容：</label>
                            <div class="col-sm-9">
                                <!--<script id="editor_4" type="text/plain"  name="form[4][content]" style="height:600px;"></script>-->
                                <textarea name="form[4][content]" style="width: 100%;height: 60px;border: 1px solid #e5e6e7;" placeholder="请用简短的语言描述"></textarea>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label">发布到：</label>

                            <div class="col-sm-10">
                                <label class="checkbox-inline"><input type="checkbox" name="form[4][language][]" value="cn" >中文</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[4][language][]" value="en" >英语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[4][language][]" value="fr" >法语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[4][language][]" value="es" >西班牙语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[4][language][]" value="pt" >葡萄牙语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[4][language][]" value="ru" >俄语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[4][language][]" value="ar" >阿拉伯语</label>
                            </div>
                        </div>
                    </div>
                </form>

                <form class="form-horizontal m-t content-form"  method="post" style="display: none;">
                    <div class="ibox-content">
                        <div class="form-group">
                            <label style="float: left;color:red;">第6组</label>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">标题：</label>
                            <div class="col-sm-9">
                                <input name="form[5][title]" class="form-control input-title" type="text">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">时间：</label>
                            <div class="col-sm-9">
                                <input name="form[5][time]" class="form-control input-title" type="text" placeholder="请输入年份，例如'1998年' ">
                            </div>
                        </div>
                        <div class="form-group" style="margin-bottom:13px">
                            <label class="col-sm-2 control-label">图片：</label>
                            <div class="col-sm-9">

                                <img id="course_image_6" src="" alt="" width='180' height="130">
                                <button onclick="clickInputFile(this)" class="btn" type="button">上传</button>
                                <input type="hidden" name="form[5][img]" value="">
                                <input type="file" accept="image/*" style="opacity:0;margin-top:-25px;width:0px;" name="upfile" id="course_image_6_file" onchange="uploadFile(this)"/>

                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label">内容：</label>
                            <div class="col-sm-9">
                                <!--<script id="editor_5" type="text/plain"  name="form[5][content]" style="height:600px;"></script>-->
                                <textarea name="form[5][content]" style="width: 100%;height: 60px;border: 1px solid #e5e6e7;" placeholder="请用简短的语言描述"></textarea>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label">发布到：</label>

                            <div class="col-sm-10">
                                <label class="checkbox-inline"><input type="checkbox" name="form[5][language][]" value="cn" >中文</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[5][language][]" value="en" >英语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[5][language][]" value="fr" >法语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[5][language][]" value="es" >西班牙语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[5][language][]" value="pt" >葡萄牙语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[5][language][]" value="ru" >俄语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[5][language][]" value="ar" >阿拉伯语</label>
                            </div>
                        </div>
                    </div>
                </form>

                <form class="form-horizontal m-t content-form"  method="post" style="display: none;">
                    <div class="ibox-content">
                        <div class="form-group">
                            <label style="float: left;color:red;">第7组</label>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">标题：</label>
                            <div class="col-sm-9">
                                <input name="form[6][title]" class="form-control input-title" type="text">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">时间：</label>
                            <div class="col-sm-9">
                                <input name="form[6][time]" class="form-control input-title" type="text" placeholder="请输入年份，例如'1998年' ">
                            </div>
                        </div>
                        <div class="form-group" style="margin-bottom:13px">
                            <label class="col-sm-2 control-label">图片：</label>
                            <div class="col-sm-9">

                                <img id="course_image_7" src="" alt="" width='180' height="130">
                                <button onclick="clickInputFile(this)" class="btn" type="button">上传</button>
                                <input type="hidden" name="form[6][img]" value="">
                                <input type="file" accept="image/*" style="opacity:0;margin-top:-25px;width:0px;" name="upfile" id="course_image_7_file" onchange="uploadFile(this)"/>

                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label">内容：</label>
                            <div class="col-sm-9">
                                <!--<script id="editor_6" type="text/plain"  name="form[6][content]" style="height:600px;"></script>-->
                                <textarea name="form[6][content]" style="width: 100%;height: 60px;border: 1px solid #e5e6e7;" placeholder="请用简短的语言描述"></textarea>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label">发布到：</label>

                            <div class="col-sm-10">
                                <label class="checkbox-inline"><input type="checkbox" name="form[6][language][]" value="cn" >中文</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[6][language][]" value="en" >英语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[6][language][]" value="fr" >法语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[6][language][]" value="es" >西班牙语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[6][language][]" value="pt" >葡萄牙语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[6][language][]" value="ru" >俄语</label>
                                <label class="checkbox-inline"><input type="checkbox" name="form[6][language][]" value="ar" >阿拉伯语</label>
                            </div>
                        </div>
                    </div>
                </form>


                <div style="margin-top: 10px;" class="form-group">
                    <div class="col-sm-3 " style="float: right;">
                        <button onclick="addSubmit()" class="btn btn-primary ajax-post" type="submit">提交</button>
                        <a class="btn btn-primary" href="<{:U('News/index')}>">取消</a>
                    </div>
                </div>
                <a id="add-btn" href="javascript:addOne(this)" class="btn btn-primary btn-outline">向下添加一种语言</a>
                <a id="del-btn" href="javascript:delOne(this)" class="btn btn-primary btn-outline">移除上一种语言</a>

            </div>
        </div>
    </div>

</div>

<!-- head的闭合 -->
</div>
</div>
</div>

<script type="text/javascript">
    function clickInputFile(_this) {
        $(_this).nextAll('input:file').trigger('click');
    }

    function uploadFile(_this){
        var eleId = $(_this).attr('id');
        var imgObj = $(_this).siblings('img');
        var inputHidden = $(_this).siblings('input:hidden');
        $.ajaxFileUpload(
                {
                    url:'<{:U("Image/uploadPic")}>', //你处理上传文件的服务端
                    secureuri:false,
                    fileElementId:eleId,
                    dataType: 'text',
                    success: function (data){
                        console.log(data);
                        imgObj.attr('src',data);
                        inputHidden.val(data);
                    }
                }
        )
    }
</script>

<!-- head的闭合 -->
<script type="text/javascript">
    $(function () {
        /**
         * 复选框添加点击事件，同时对七组的语言复选框生效
         * 可以防止同一种语言重复的问题
         */
        $('input:checkbox').click(function(){
            var thisCheck = this.checked;
            var thisVal = $(this).val();
            if (thisCheck) {
                $('input:checkbox[value="'+thisVal+'"]').attr('disabled','disabled').parent().hide();//先将所有的禁用并隐藏
                $(this).removeAttr('disabled').parent().show();//再将当前这个复选框解除禁用并显示
            } else {
                $('input:checkbox[value="'+thisVal+'"]').removeAttr('disabled').parent().show();//显示所有的语言复选框
            }
        });
    });



//    var ue_cn = UE.getEditor('editor_0');
//    var ue_en = UE.getEditor('editor_1');
//    var ue_fr = UE.getEditor('editor_2');
//    var ue_es = UE.getEditor('editor_3');
//    var ue_pt = UE.getEditor('editor_4');
//    var ue_ru = UE.getEditor('editor_5');
//    var ue_ar = UE.getEditor('editor_6');

    var curr = 1;
    function addOne(_this){
        //如果已经选择了七种语言，则不让继续添加
        if ($('input:checkbox:checked').length >= 7) {
            bootbox.alert({
                message: '您已选择了7种语言',
                buttons: {
                    ok: {
                        label: " 确 定 ",
                        className: "btn-primary btn-sm",
                    }
                }
            });
            return;
        }
        //已经有7组处于显示状态则不让继续添加
        if (curr >= 7) {
            bootbox.alert({
                message: '您已经添加了7组输入框',
                buttons: {
                    ok: {
                        label: " 确 定 ",
                        className: "btn-primary btn-sm",
                    }
                }
            });
            return;
        }
        $('.content-form').eq(curr).show();
        curr++;
    }
    function delOne(_this){
        if (curr <= 1) {
            bootbox.alert({
                message: '只剩一组输入框，禁止删除',
                buttons: {
                    ok: {
                        label: " 确 定 ",
                        className: "btn-primary btn-sm",
                    }
                }
            });
            return;
        }
        $('.content-form').eq(curr-1).hide();
        $('.content-form').eq(curr-1).find('input:checkbox').each(function(i,e){//如果当前删除的表单中含有复选框处于选中状态，则移除选中状态
            var eCheck = e.checked;
            var eValue = e.value;
            if (eCheck) {
                $('input:checkbox[value="'+eValue+'"]').removeAttr('disabled').parent().show();
            }
        });
        curr--;
    }


    function addSubmit(){
        var postData = '';
        var flag = false;//是否继续执行该方法的标识，如果下列循环中有一种不符合条件，则不提交后台
        $('.content-form:visible').each(function(i,e){//只获取处于显示状态的form表单
            var langVal = $(e).find("input:checkbox:checked").length;//当前这个form表单选择发布语言的数量
            var titleVal = $(e).find(".input-title").val();//当前这个form表单的标题值
            if (!titleVal) {
                bootbox.alert({
                    message: '第'+(i+1)+'组标题为空，请填写后再提交',
                    buttons: {
                        ok: {
                            label: " 确 定 ",
                            className: "btn-primary btn-sm",
                        }
                    }
                });
                flag = true;
                return false;
            }
            if (langVal == 0) {
                bootbox.alert({
                    message: '第'+(i+1)+'组未选择语言，请选择后再提交',
                    buttons: {
                        ok: {
                            label: " 确 定 ",
                            className: "btn-primary btn-sm",
                        }
                    }
                });
                flag = true;
                return false;
            }
            postData += $(e).serialize() + "&";//将序列化后的值拼到一起
        });

        if (flag) {
            return;
        }

        $.post('<{:U("News/add")}>',postData,function(result){
//            bootbox.alert({
//                message: result.info,
//                buttons: {
//                    ok: {
//                        label: " 确 定 ",
//                        className: "btn-primary btn-sm",
//                    }
//                }
//            });
            location.href = result.url;
        });
    }

</script>

</body>

</html>
